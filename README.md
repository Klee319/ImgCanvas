# Image Canvas - 高度な画像編集ツール

モダンで直感的な画像コレクション・編集ツールです。クリップボードから画像を貼り付けて、高度な編集機能で自由に管理できます。

## 🚀 主要機能

### 📋 クリップボード機能

- **Ctrl+V / ⌘+V** でクリップボードから画像を直接貼り付け
- 個別画像のクリップボードへのコピー機能
- フォールバック機能で様々なブラウザに対応

### 🎨 ドラッグ & ドロップ

- **フリーモード**: 画像をスムーズに自由な位置にリアルタイム移動
- **グリッドモード**: 構造化されたドラッグ＆ドロップ配置
- モード切り替えによる異なる操作体験
- スムーズなアニメーションとハプティックフィードバック
- 絶対配置による正確な位置制御

### 🔧 画像リサイズ機能

- **角ハンドル**: 画像の四隅をドラッグしてサイズ変更
- **アスペクト比ロック**: デフォルトON、アイコンクリックまたはShiftキーで切替
- **Shiftキー**: アスペクト比を保持したリサイズ（ロック状態に関係なく）
- **最小サイズ制限**: 50px以下にならない安全な制限
- **リアルタイム更新**: ドラッグ中の即座なサイズ反映
- **視覚的フィードバック**: リサイズ中のヘルプテキスト表示

### ✂️ 画像トリミング機能

- **ドラッグ選択**: マウスで矩形範囲を直感的に選択
- **数値入力**: X、Y、幅、高さを精密に入力
- **リアルタイムプレビュー**: 選択範囲の即座な視覚化
- **キャンセル機能**: 元画像の完全保持
- **Base64生成**: 新しいトリミング画像を効率的に作成

### ↶ Undo/Redo 履歴管理

- **最大50ステップ**: 豊富な操作履歴
- **キーボードショートカット**: Ctrl+Z、Ctrl+Shift+Z (Mac: ⌘Z, ⌘⇧Z)
- **ツールバー**: ヘッダ中央の↶/↷ボタン
- **ステップ表示**: 現在の履歴位置と残りステップ数
- **高速差分**: 16ms以内の即座な状態復元

### 🗂 レイヤー順序管理

- **z-index制御**: 画像ごとの重なり順序管理
- **右クリックメニュー**: Bring Forward、Send Backward
- **ホットキー**: [（背面へ）、]（前面へ）
- **レイヤーサイドバー**: Lキーでトグル表示/非表示
- **可視性切替**: 個別画像の表示/非表示
- **ドラッグ順序変更**: サイドバー内でのレイヤー並び替え

### 📥 画像単体ダウンロード

- **複数形式**: PNG / JPEG / WebP 対応
- **画質選択**: 100%, 80%, 60% から選択
- **プレビュー**: ダウンロード前の画像確認
- **ファイルサイズ予測**: 形式・画質に基づく推定値
- **右クリックメニュー**: 「Download as...」で簡単アクセス

### 💾 データ永続化

- localStorage による全データの自動保存
- リロード後も配置・設定を完全保持
- Base64 形式による効率的な画像保存
- 移動モード、アスペクト比ロック設定の保存
- 履歴状態の復元

### 🌙 ダークモード対応

- ワンクリックでライト/ダークモード切り替え
- 全 UI コンポーネントがダークモード完全対応
- システム設定に関係なく独立したテーマ管理
- 高コントラスト比 4.5:1 以上で色覚バリアブル適合

### 📥 書き出し機能

- 配置されたすべての画像を一つの PNG ファイルとして書き出し
- Canvas API を使用した高品質な画像合成
- 自動的な画像境界計算と適切なパディング

### ♿ アクセシビリティ

- スクリーンリーダー完全対応
- 全操作にキーボード代替手段を提供
- 適切な ARIA ラベルと説明
- フォーカス管理とタブナビゲーション

## 🛠 技術スタック

- **React 18** + **TypeScript** - モダンなフロントエンド開発
- **Vite 5** - 高速な開発環境とビルドツール
- **Tailwind CSS v4** - ユーティリティファーストのスタイリング
- **Framer Motion 11** - 滑らかなアニメーション
- **@dnd-kit 7** - アクセシブルなドラッグ&ドロップ
- **@heroicons/react** - 美しいアイコンセット
- **Immer 11** - 履歴管理のための不変性ライブラリ
- **FileSaver 2** - ブラウザファイルダウンロード

## 🔧 セットアップ・起動方法

### 1. 依存関係のインストール

```bash
npm install
```

### 2. 開発サーバーの起動

```bash
npm run dev
```

→ http://localhost:3000 でアプリケーションが起動します

### 3. プロダクションビルド

```bash
npm run build
```

### 4. ビルド結果のプレビュー

```bash
npm run preview
```

## 📝 使用方法

### 基本操作

1. **画像の貼り付け**: `Ctrl+V` (Windows) または `⌘+V` (Mac) でクリップボードから画像を貼り付け

2. **移動モードの選択**:

   - **フリーモード（🎯）**: ヘッダーのアイコンをクリック
     - スムーズでリアルタイムな画像移動
     - マウスドラッグで即座に位置変更
     - カクつきのない滑らかな操作感
   - **グリッドモード（⚏）**: ヘッダーのアイコンをクリック
     - 構造化されたドラッグ&ドロップ
     - より制御された移動

3. **アスペクト比ロック**:
   - **デフォルト**: ON（比率固定）
   - **ヘッダーボタン**: 🔒/🔓 アイコンでトグル
   - **リサイズ時**: Shiftキー押下で一時的に切替

### 高度な編集機能

4. **画像のリサイズ**:

   - 画像にマウスオーバーすると四隅に青いハンドルが表示
   - **基本リサイズ**: 任意のハンドルをドラッグしてサイズ変更
   - **比率固定リサイズ**: ロック状態またはShiftキー押下で元の比率を保持
   - **最小サイズ**: 50px以下には縮小できません

5. **画像のトリミング**:

   - **右クリック** → 「トリミング」を選択
   - **ドラッグ選択**: マウスで矩形範囲を指定
   - **数値入力**: X、Y、幅、高さを直接入力
   - **適用**: 変更を確定、**キャンセル**: 元画像を保持

6. **履歴操作（Undo/Redo）**:

   - **Ctrl+Z / ⌘Z**: 元に戻す
   - **Ctrl+Shift+Z / ⌘⇧Z**: やり直し
   - **ツールバー**: ヘッダー中央の↶/↷ボタン
   - **最大50ステップ**: 豊富な操作履歴

7. **レイヤー管理**:

   - **Lキー**: レイヤーサイドバーのトグル
   - **右クリック**: Bring Forward / Send Backward
   - **ホットキー**: `[`（背面へ）、`]`（前面へ）
   - **サイドバー**: ドラッグで順序変更、目アイコンで可視性切替

8. **個別画像ダウンロード**:
   - **右クリック** → 「ダウンロード...」
   - **形式選択**: PNG、JPEG、WebP
   - **画質選択**: 100%、80%、60%（JPEG、WebPのみ）
   - **プレビュー**: ダウンロード前の確認

### ホバー操作

9. **個別操作**: 画像にホバーすると表示されるツールバーから：

   - 📋 クリップボードにコピー
   - 🔒/🔓 アスペクト比ロック切替
   - 🔧 リサイズ可能（インジケーター）
   - 🗑 画像を削除

10. **書き出し**: 右上の「PNG書き出し」ボタンで全画像を一つのファイルとして保存

11. **テーマ変更**: 右上の 🌙/☀️ ボタンでダークモード切り替え

## ⌨️ キーボードショートカット

### 履歴操作

- `Ctrl+Z` / `⌘Z`: 元に戻す
- `Ctrl+Shift+Z` / `⌘⇧Z`: やり直し

### レイヤー操作

- `L`: レイヤーサイドバーの表示/非表示
- `[`: 選択画像を背面へ
- `]`: 選択画像を前面へ

### 画像操作

- `Ctrl+V` / `⌘V`: クリップボードから画像貼り付け
- `Shift` + ドラッグ: アスペクト比固定リサイズ（一時的）

## 🎯 移動モードについて

### フリーモード（🎯）

- **リアルタイム移動**: ドラッグ中に画像が即座に追従
- **スムーズな操作感**: カクつきのない滑らかな動作
- **自由配置**: ピクセル単位での精密な位置調整
- **パフォーマンス最適化**: requestAnimationFrameによる効率的な描画

### グリッドモード（⚏）

- **構造化された移動**: @dnd-kitによる安定したドラッグ&ドロップ
- **アクセシビリティ重視**: スクリーンリーダー完全対応
- **予測可能な動作**: 一貫性のある移動パターン

## 🔧 リサイズ機能詳細

### アスペクト比ロック

- **デフォルト状態**: ON（🔒アイコン）
- **ヘッダー切替**: アイコンクリックでON/OFF
- **一時的切替**: Shiftキー押下（ロック状態に関係なく）
- **視覚的表示**: ツールバーとヘッダーに状態表示

### リサイズハンドル

- **四隅ハンドル**: 画像の角をドラッグしてサイズ変更
- **SE (右下)**: 最も一般的な拡大縮小
- **SW (左下)**: 左端固定で幅と高さを調整
- **NE (右上)**: 上端固定で幅と高さを調整
- **NW (左上)**: 対角線上の自由なリサイズ

### 制限事項

- **最小サイズ**: 50px × 50px（視認性確保）
- **元画像情報**: 貼り付け時の原寸サイズを記録し比率計算に使用

## ✂️ トリミング機能詳細

### 操作方法

1. **開始**: 画像を右クリック → 「トリミング」選択
2. **範囲選択**: ドラッグで矩形選択または数値入力
3. **調整**: リアルタイムプレビューで確認
4. **確定**: 「適用」ボタンまたは「キャンセル」

### 機能特徴

- **ドラッグ選択**: 直感的なマウス操作
- **数値入力**: X、Y、幅、高さの精密制御
- **境界制限**: 元画像サイズ内での制約
- **リアルタイム**: 選択中の即座な視覚フィードバック

## 🗂 レイヤー管理詳細

### サイドバー機能

- **表示切替**: Lキーまたはヘッダーボタン
- **レイヤーリスト**: z-index順での表示
- **プレビュー**: 各レイヤーのサムネイル
- **情報表示**: サイズ、レイヤー番号

### 順序操作

- **ドラッグ**: サイドバー内での並び替え
- **ボタン**: 各レイヤーの上下移動
- **右クリック**: コンテキストメニューから操作
- **ホットキー**: [/] による前面/背面移動

## 📥 ダウンロード機能詳細

### 対応形式

- **PNG**: 可逆圧縮、透明度サポート、最高品質
- **JPEG**: 非可逆圧縮、小さなファイルサイズ、画質選択可能
- **WebP**: 高効率圧縮、モダンフォーマット、画質選択可能

### 画質オプション

- **100%**: 最高品質（大きなファイル）
- **80%**: 高品質（バランス良い、推奨）
- **60%**: 標準品質（小さなファイル）

### ファイルサイズ予測

- **アルゴリズム**: ピクセル数と圧縮率による推定
- **精度**: 実際のサイズに近い予測値
- **表示**: KB/MB単位での分かりやすい表示

## 🔍 開発者向け

### コードフォーマット

```bash
npm run format
```

### リンター実行

```bash
npm run lint
npm run lint:fix
```

### プロジェクト構造

```
src/
├── components/          # UIコンポーネント
│   ├── Header.tsx       # メインヘッダー
│   ├── ImageCanvas.tsx  # 画像キャンバス
│   ├── DraggableImage.tsx # ドラッグ可能画像
│   ├── HistoryToolbar.tsx # 履歴ツールバー
│   ├── LayerSidebar.tsx   # レイヤーサイドバー
│   ├── CropOverlay.tsx    # トリミングオーバーレイ
│   └── DownloadDialog.tsx # ダウンロードダイアログ
├── context/             # React Context（状態管理）
│   └── ImageContext.tsx # 画像・履歴管理
├── hooks/               # カスタムフック
│   ├── useClipboard.ts    # クリップボード操作
│   ├── usePasteHandler.ts # 画像貼り付け
│   ├── useExport.ts       # 書き出し機能
│   └── useKeyboardShortcuts.ts # ショートカット
├── types/               # TypeScript型定義
│   └── index.ts         # 全型定義
├── App.tsx              # メインアプリ
├── main.tsx             # エントリーポイント
└── index.css            # グローバルスタイル
```

## 🌟 特徴

- **高度な編集機能**: トリミング、リサイズ、レイヤー管理
- **豊富な履歴管理**: 50ステップのUndo/Redo
- **多彩なダウンロード**: PNG/JPEG/WebP対応
- **リアクティブデザイン**: あらゆるデバイスサイズに対応
- **高パフォーマンス**: React 18とImmerによる最適化
- **開発者体験**: TypeScript + ESLint + Prettier による型安全な開発環境
- **モダンUI**: Tailwind CSS による一貫性のあるデザインシステム
- **柔軟な操作性**: フリー・グリッド2つの移動モードを選択可能
- **直感的編集**: 右クリックメニューとキーボードショートカット
- **完全ブラウザ内処理**: 外部送信なしのセキュアな画像処理

## 🛡️ セキュリティ

- **ローカル処理**: 全画像処理をブラウザ内で完結
- **外部送信なし**: プライバシー保護の徹底
- **XSS対策**: ファイル名のサニタイズ処理
- **メモリ管理**: 適切なリソース解放

## 📈 パフォーマンス

- **リサイズ**: 100ms以内の即時反映
- **履歴操作**: 16ms以内の高速差分表示
- **トリミング**: 120ms以内の滑らかな遷移
- **メモリ効率**: Immerによる構造共有

## 📱 アクセシビリティ

- **WCAG 2.1 AA準拠**: 色覚バリアブル対応
- **キーボードナビゲーション**: 全機能をキーボードで操作可能
- **スクリーンリーダー**: 適切なARIAラベル
- **フォーカス管理**: 論理的なタブ順序

## 🆕 バージョン 2.0 新機能

### 画像編集機能

- ✅ アスペクト比ロック付きリサイズ
- ✅ ドラッグ＆数値入力によるトリミング
- ✅ 最大50ステップのUndo/Redo
- ✅ 完全なレイヤー順序管理
- ✅ PNG/JPEG/WebP画像単体ダウンロード

### UI/UX向上

- ✅ 右クリックコンテキストメニュー
- ✅ レイヤーサイドバー（Lキー切替）
- ✅ 履歴ツールバー（↶/↷ボタン）
- ✅ 直感的なキーボードショートカット
- ✅ 豊富な視覚的フィードバック

### 技術的改善

- ✅ Immerによる不変性管理
- ✅ FileSaverによる高品質ダウンロード
- ✅ パフォーマンス最適化
- ✅ メモリ効率向上
- ✅ エラーハンドリング強化

## �� ライセンス

MIT License
